# diff-report
MT5外汇回测报告分析工具，用于导出报告多份之后整体对比结果甄选混合品种策略的优等品种抽取

## 功能特性

- **自动化处理**：自动扫描指定目录下的所有回测报告（.xlsx 文件）
- **详细分析**：为每个文件提供品种级盈亏分析（盈利、亏损、净收益、交易次数）
- **品种表现对比**：识别每个文件中表现最佳和最差的品种
- **全局汇总**：整合所有回测文件数据，提供全局品种表现视图
- **稳定性分析**：识别在所有回测中持续盈利或亏损的品种

## 使用说明

### 前置要求

- Python 3.6+
- 依赖库：
  ```
  pip install pandas openpyxl
  ```

### 使用方法

```bash
python analyze_backtest.py <回测报告目录路径>
```

示例：
```bash
python analyze_backtest.py /path/to/backtest_reports
```

### 输出内容

1. **文件级报告**：
   - 每个文件的交易品种盈亏明细
   - 每个文件中表现最佳（盈利最多）的品种
   - 每个文件中表现最差（亏损最多）的品种
   - 每个品种的交易次数统计

2. **全局汇总报告**：
   - 所有回测文件的品种综合表现
   - 全局表现最佳品种
   - 全局表现最差品种
   - 稳定盈利品种（在所有回测中持续盈利）
   - 持续亏损品种（在所有回测中持续亏损）

### 报告格式示例

```
========== 开始分析目录: /backtests ==========
找到 5 个回测文件

★ 文件: Report1.xlsx
==================================================
            total_profit  total_loss  net_profit  trades
交易品种                                                 
EURUSD           1200.50     -300.25      900.25      15
GBPUSD            800.00     -200.00      600.00      10
USDJPY            500.25     -150.75      349.50       8

最佳品种: EURUSD 净盈利 900.25
最差品种: USDJPY 净亏损 349.50
==================================================

...其他文件分析...

============================================================
                    全局汇总分析
============================================================

各品种全局表现:
            total_profit  total_loss  net_profit  trades
交易品种                                                 
EURUSD           4500.75    -1200.50     3300.25      50
GBPUSD           3200.00     -800.00     2400.00      40
AUDUSD           1800.50     -600.25     1200.25      30
USDJPY           1500.25    -1200.75      299.50      25
USDCAD           1000.00    -1000.00        0.00      20

全局最佳品种: EURUSD 净盈利 3300.25
全局最差品种: USDJPY 净亏损 299.50

稳定盈利品种:
EURUSD: 平均盈利 900.25 (在 3 个文件中持续盈利)
GBPUSD: 平均盈利 600.00 (在 2 个文件中持续盈利)

持续亏损品种:
USDJPY: 平均亏损 -299.50 (在 2 个文件中持续亏损)
```

## 注意事项

1. **文件格式要求**：
   - 只处理 .xlsx 格式文件
   - Excel 文件必须包含以下列：
     - `交易品种`（品种名称）
     - `盈利`（每笔交易的盈亏金额）

2. **数据处理**：
   - 自动跳过每个文件的最后一行（MT4/MT5 的汇总行）
   - 要求品种至少出现在2个文件中才进行稳定性评估
   - 所有金额数据保留两位小数

3. **错误处理**：
   - 如果文件缺少必要列，会显示具体错误信息
   - 单个文件处理错误不会中断整体分析
   - 无效目录路径会被检测并提示

## 贡献

欢迎贡献！请通过 Issues 提交问题或通过 Pull Request 提交改进。

1. Fork 项目
2. 创建分支 (`git checkout -b feature/your-feature`)
3. 提交更改 (`git commit -am 'Add some feature'`)
4. 推送到分支 (`git push origin feature/your-feature`)
5. 创建 Pull Request

## 许可证

本项目采用 [MIT 许可证](LICENSE)。
